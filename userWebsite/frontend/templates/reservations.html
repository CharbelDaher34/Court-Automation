<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reserve Court Section</title>
  </head>
  <style>
    body {
      font-family: Arial, sans-serif; /* Ensures text is in Arial, if not available then sans-serif */
      text-align: center; /* Centers all the text inside the body */
      font-size: 18px; /* Increases the font size */
    }
    
    h1,
    h2,
    h3 {
      margin-top: 20px; /* Adds space above each heading */
    }
    
    ul {
      list-style-type: none; /* Removes bullet points from list */
      padding: 0; /* Removes padding */
    }
    
    li {
      margin-bottom: 10px; /* Adds space below each list item */
    }
    
    form {
      margin-top: 20px; /* Adds space above the form */
    }
    
    button {
      font-size: 16px; /* Larger font size for better readability */
      padding: 10px 20px; /* Padding around the text in the button */
      cursor: pointer; /* Shows a pointer cursor on hover */
      width: 200px;
      height: 30px;
      margin: 5px;
    }
    
    /* Overall form styling */
    #reserveForm {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 300px;
      margin: 0 auto; /* Center the form horizontally */
      padding: 20px;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-family: sans-serif;
    }
    
    /* Labels and inputs */
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    
    input[type='email'],
    input[type='password'],
    input[type='time'] {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 3px;
      font-size: 16px;
    }
    
    /* Password toggle eye icon */
    #togglePassword {
      cursor: pointer;
      margin-left: 5px;
    }
    
    /* Button */
    #reserveButton {
      background-color: #4caf50; /* Green color */
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 15px;
    }
    
    /* Button hover effect */
    #reserveButton:hover {
      background-color: #45a049; /* Slightly darker green on hover */
    }
  </style>

  <body onload="init()">
    <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}" id="csrf_token" />

        <h1>Reserve Court Section</h1>
    <h2>Court Section: {{ court_section.sectionName }}</h2>
    <h2>Date: {{ date }}</h2>

    <h3>Available Time Slots:</h3>
    <ul>
      {% for slot in available_slots %}
        <li>{{ slot }}</li>
      {% endfor %}
    </ul>

    <h3>Reserve Time Slot:</h3>

    <div id="reserveForm">
      <label for="email">Email:</label>
      <input type="email" id="email" name="email" /><br /><br />
      <label for="password">Password:</label>
      <input type="password" id="password" name="password" />

      <input type="hidden" name="available_slots" value="{{ available_slots }}" id="slots" />
      <p>
        <label for="startTime">Start Time:</label>
        <input type="time" name="start_time" required="" id="startTime" />
      </p>
      <p>
        <label for="endTime">End Time:</label>
        <input type="time" name="end_time" required="" id="endTime" />
      </p>
      <button id="reserveButton" onclick="checkAvailability()">Reserve</button>
    </div>

    <button id="show" onclick="showForm()">create user</button>

    <form id="userCreationForm">
      <label for="firstName">First Name:</label><br />
      <input type="text" id="firstName" name="firstName" /><br /><br />

      <label for="lastName">Last Name:</label><br />
      <input type="text" id="lastName" name="lastName" /><br /><br />

      <label for="email">Email:</label><br />
      <input type="email" id="userCreationemail" name="email" /><br /><br />

      <label for="password">Password:</label>
      <input type="password" id="userCreationPassword" name="password" />

      <label for="number">Phone Number:</label><br />
      <input type="tel" id="number" name="number" placeholder="Format: 123-456-7890" /><br /><br />

      <label for="country">Country:</label><br />
      <input type="text" id="country" name="country" /><br /><br />

      <label for="address">Address:</label><br />
      <input type="text" id="address" name="address" /><br /><br />

      <label for="date_of_birth">Date of Birth:</label><br />
      <input type="date" id="date_of_birth" name="date_of_birth" /><br /><br />

      <label for="sex">Sex:</label><br />
      <select id="sex" name="sex">
        <option value="M">Male</option>
        <option value="F">Female</option>
      </select>
      <br /><br />
      <button onclick="submitForm()">submit</button>
    </form>
    <br /><br /><br />

    <footer>
      <p></p>
    </footer>
  </body>

  <script>

    function init() {
      alert("toa");
      document.getElementById('userCreationForm').style.display = 'none';
    }
    
    function showForm() {
      document.getElementById('userCreationForm').style.display = 'block'
    }

    function submitForm() {
      // Get references to all input elements
      alert("form is");
      const firstNameInput = document.getElementById('firstName');
      const lastNameInput = document.getElementById('lastName');
      const emailInput = document.getElementById('userCreationemail'); // Updated ID
      const passwordInput = document.getElementById('userCreationPassword'); // New ID
      const numberInput = document.getElementById('number');
      const countryInput = document.getElementById('country');
      const addressInput = document.getElementById('address');
      const dobInput = document.getElementById('date_of_birth');
      const sexSelect = document.getElementById('sex');
    
      // Extract values from each input
      const firstName = firstNameInput.value;
      const lastName = lastNameInput.value;
      const email = emailInput.value;
      const password = passwordInput.value; // New variable for password
      const phoneNumber = numberInput.value;
      const country = countryInput.value;
      const address = addressInput.value;
      const dateOfBirth = dobInput.value;
      const sex = sexSelect.value;
    
      // Prepare data object for sending the request
      const userData = {
        firstName,
        lastName,
        email,
        password, // Include password in the data object
        phoneNumber,
        country,
        address,
        dateOfBirth,
        sex,
      };


      fetch('http://localhost:8000/backend/create_user/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'

        },
        body: JSON.stringify(userData)
    })
    .then(response => {
        if (response.ok) {
            alert("User created successfully!");
        } else {
            throw new Error('Failed to create user');
        }
    })
    .catch(error => {
        alert("Error creating user: " + error.message);
    });
    alert("finish");

}
    

    
    function checkAvailability() {
      var startTime = document.getElementById('startTime').value
      var endTime = document.getElementById('endTime').value
      let available_slots = document.getElementById('slots').value
    
      // Convert startTime and endTime to integers
      let [hours, minutes] = startTime.split(':')
      let startHour = parseInt(hours)
      let startMin = parseInt(minutes)
    
      ;[hours, minutes] = endTime.split(':')
      let endHour = parseInt(hours)
      let endMin = parseInt(minutes)
    
      // Convert available_slots to a list of tuples of integers
      let stringData = available_slots.replace(/\[|\]|\(/g, '')
      let dataArray = stringData.replace(/'/g, '').split('),')
      dataArray = dataArray.map((item) => item.trim())
      parts = dataArray[0].split(',').map((part) => part.trim())
      available_slots = parts.map((part) => {
        let [hour, minute] = part.split(':').map((num) => parseInt(num))
        return [hour, minute]
      })
    
      alert(startTime + ' ' + endTime)
      let isAvailable = false // Initialize availability flag to false
    
      for (let i = 0; i < available_slots.length; i++) {
        let slot = available_slots[i]
        let slotStartHour = slot[0][0]
        let slotStartMin = slot[0][1]
        let slotEndHour = slot[1][0]
        let slotEndMin = slot[1][1]
    
        // Check if start time falls within the current available slot
        if (
          (startHour > slotStartHour || (startHour === slotStartHour && startMin >= slotStartMin)) &&
          // Check if end time also falls within the current available slot
          (endHour < slotEndHour || (endHour === slotEndHour && endMin <= slotEndMin))
        ) {
          isAvailable = true // Slot found, set flag to true
          break // Exit the loop once a slot is found
        } else {
          // No match, continue checking other slots
        }
      }
    
      alert('Available: ' + isAvailable)
    }


    function updateDateTime() {
      const now = new Date();
      const dateTimeString = now.toLocaleString();
      const footerElement = document.querySelector('footer p');
      footerElement.textContent = `${dateTimeString}`;
  }

  setInterval(updateDateTime, 1000); // Update every second


 
  


  </script>
</html>
